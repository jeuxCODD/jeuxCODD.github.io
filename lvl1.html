<html>
    <head>
        <meta charset="UTF-8">
        <title>DemieVieMorue</title>
        <link rel="stylesheet" href="css/styleLVL1.css" />
        <!-- Howler js est un api qui facilite le son pour les jeux, il y a beaucoup de documentation sur le sujet. Visite howlerjs.com -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    </head>
    <body>
        <div class=header>  
          <h1>
                Aidez <span id="morue-display"></span> à s'échapper! 
                <a class="menu" href="index.html"><img src="https://www.iconpacks.net/icons/2/free-home-icon-2502-thumb.png" width=40px ></a>
                <input type="image" id="bouttonMute" src="images/audioOff.png" style="height: 55px; margin-left: 30px; float: right;" onclick="sonOffOn()"/>
          </h1> 
        </div>
        <div class=game id=game-zone style="width: 90%;">
            <!-- Image Map Generated by http://www.image-map.net/ -->
            <img src="images/image.png" usemap="#image-map">
            
            <map name="image-map">
                <area target="_blank" alt="Validation" title="Valide?" onclick="submitPH()"
                    coords="407,214,410,223,403,228,395,232,387,229,382,221,280,220,280,214,383,214,386,208,398,205,404,209,404,209" shape="poly">
                <area target="_blank" alt="Acide" title="Acide" onclick="openDiv('A')"
                    coords="133,246,160,296,170,288,163,274,171,271,168,266,175,262,183,270,194,266,176,238,167,243,172,252,163,258,161,254,152,257,142,242" shape="poly">
                <area target="_blank" alt="Base" title="Base" onclick="openDiv('B')"
                    coords="498,240,483,267,491,272,497,263,508,266,505,274,513,276,505,292,517,298,542,249,533,245,524,258,515,254,512,259,502,253,507,245" shape="poly">
                <area target="_blank" alt="liquideFinale" title="liquideFinale" 
                    coords="249,402,252,420,258,441,274,460,293,475,384,476,406,460,420,442,428,424,429,411,401,416,372,413,342,407,319,397,285,395" shape="poly">
                <area target="_blank" alt="liquideGauche" title="Acide (0.0pH)" 
                    coords="89,127,98,141,115,155,137,157,148,156,168,195,185,184,166,148,176,132,180,126,167,121,153,121,137,125,118,131,102,132,95,130" shape="poly">
                <area target="_blank" alt="liquideDroite" title="Base (14.0pH)" 
                    coords="504,130,518,133,532,132,546,129,557,124,569,121,580,121,590,125,596,126,590,139,577,150,560,157,540,158,528,169,513,195,496,184,516,148,509,139" shape="poly">
            </map>
        </div>
        <div id="input-container" class="input-box" style= "display: none">
            <input type="button" id="btnX" onclick="fermerBox()" value="x">
            <label class= "labelInput" id="input-label">Entrez une valeur:</label>
            <input type="number" id="input-field" min="0">
            <button class="inputSubmit" onclick="submitInput()">Valider</button>
        </div>
        <div id="input-container-pH" class="input-box-pH" style= "display: none">
            <input type="button" id="btnX" onclick="fermerBox()" value="x">
            <h2 class="messageFini" id="messageFini">Tu as terminer!</h2>
            <button class="inputFini" id="inputFini" onclick="window.location.assign("lvl2.html")">Continuer</button>
        </div>
        <div class="niveau-pH" id="niveau-pH" >
        </div>
        <div class="morueImage">
        <img src="images/morue.png" style="height:25px; width:30px">
        </div>
        <script>
            function fermerBox(){
                const fermerBoite = document.getElementById("input-container");
                fermerBoite.style.display = "none";
            
            }
            function sonOffOn() {
                //determine si audio joue ou non
                if (sonJoue) {
                    themeMusic.mute(true, idTheme);
                    sonJoue = false
                    document.getElementById('bouttonMute').src='images/audio.png'
                } else {
                    themeMusic.mute(false, idTheme);
                    sonJoue = true;
                    document.getElementById('bouttonMute').src='images/audioOff.png'
                }
            }
            
            //musique
            let idTheme;
            let sonJoue = true;
            const themeMusic = new Howl({
                src: ['audio/mainTheme.wav', 'audio/mainTheme.mp3', 'audio/mainTheme.m4a'], // change path if needed
                volume: 0.5,
                autoplay: true,
                html5: true,
                loop: true
            });
            
            const effetsSon = new Howl({
                //au moin un source est nessesaire, si le premier ne fonctionne pas, howler va passer au deuxième, troisième etc
                src: [''],
                volume: 0.3,
                //établis des section de l'audio source pour jouer, (debut, fin) en millisecondes.
                sprite: {
                    valve: [0, 2000],
                    clique: [2000, 3000],
                    eclabousse: [3000, 5000],
                    gagner: [5000, 10000]
                }
            });
            // pour jouer un sprite: 
            //    effetsSon.play('valve');
            var pH = (Math.random() * 14).toFixed(2);
            while (pH < 8.5 && pH > 6.5){
                pH = (Math.random() * 14).toFixed(2);
            }
            console.log(pH);
            var pHOutput = document.getElementById("niveau-pH");
            
            var morueNom = localStorage.getItem("nom-morue");
            var affiche = document.getElementById("morue-display");
            affiche.innerHTML += morueNom;
            
            var currentPuzzle = "";
            var montantAcide = 0;
            var montantBase = 0;
            var pHInit = pH;
            pHOutput.innerHTML = pH + " pH";

            function openDiv(puzzleId) {
                currentPuzzle = puzzleId;
                var div = document.getElementById("input-container");
                div.style.display = "block";
                if (currentPuzzle == 'A') {
                    document.getElementById("input-label").textContent = "Entrez un montant de moles d'acide";
                    document.getElementById("input-field").value = "";
                } else if (currentPuzzle == 'B') {
                    document.getElementById("input-label").textContent = "Entrez un montant de moles de base";
                    document.getElementById("input-field").value = "";
                }
            }
            function submitInput(){  
                console.log(currentPuzzle);
                if (currentPuzzle == 'A'){
                    var acide = parseFloat(document.getElementById("input-field").value);
                    console.log("acide level: " + acide);
                    if (!isNaN(acide)) {
                        montantAcide += acide;
                    }
                } else if (currentPuzzle == 'B'){
                    var base = parseFloat(document.getElementById("input-field").value);
                    if (!isNaN(base)) {
                    montantBase+= base;
                    }
                }
                pH = ((pHInit * 100) + (montantBase * 14) + (montantAcide * 0)) / (100 + montantBase + montantAcide);
                pHOutput.innerHTML = pH.toFixed(2) + " pH";
                console.log(pH);
            }

            function submitPH(){
                var phCheck = ((pHInit * 100) + (montantBase * 14) + (montantAcide * 0)) / (100 + montantBase + montantAcide);
                var div1 = document.getElementById("input-container-pH");
                div1.style.display = "block";
                if (phCheck >=7 && phCheck <=8) {
                    document.getElementById("messageFini").textContent = "BRAVO! Tu as sauvé la morue!";
                    document.getElementById("inputFini").textContent = "CONTINUER!";
                } else {
                    document.getElementById("messageFini").textContent = "Pas de Chance! Tu n'a pas sauver la morue!";
                    document.getElementById("inputFini").textContent = "Recommencer!";
                }
            }
        </script>
    </body>
</html>
